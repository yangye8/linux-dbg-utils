NAME	:= $(shell basename $(CURDIR))

#------------------------------------------------

BUILD	:= build
SOURCE	:= .

#------------------------------------------------

SOURCES	:= $(shell find $(SOURCE) -name '*.c')
OBJECTS	:= $(addprefix $(BUILD)/,$(SOURCES:%.c=%.o))

#------------------------------------------------

CFLAGS	:= -Wall -g $(shell pkg-config libv4l1 --cflags)
LDFLAGS	:= -lc $(shell pkg-config libv4l1 --libs)

#------------------------------------------------
all: $(NAME)
#------------------------------------------------

#------------------------------------------------
$(NAME): $(OBJECTS)
#------------------------------------------------
	@echo Linking...
	@$(CC) $(LDFLAGS) $(OBJECTS) -o $(NAME)
	@echo Build done.

#------------------------------------------------
$(BUILD)/%.o: %.c
#------------------------------------------------
	@echo - $<
	@mkdir -p $(BUILD)/$(SOURCE)
	@$(CC) $(CFLAGS) -I$(dir $<) -c $< -o $@

#------------------------------------------------
clean:
#------------------------------------------------
	@rm -rf $(BUILD) $(NAME)